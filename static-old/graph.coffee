#data = {"breakdown": {"input": {"random_not_specified": {"generated": "2011-03-31 05:50 UTC", "data": [1694, 2200, 2918, 3257, 3050, 2926, 4599, 2832, 1857, 1137]}, "random_specified": {"generated": "2011-03-31 05:50 UTC", "data": [1623, 2149, 3039, 3300, 3056, 2873, 4567, 2880, 1957, 1049]}}, "radio": {"random_not_specified": {"generated": "2011-03-31 05:50 UTC", "data": [1643, 2102, 2961, 3983, 2994, 3330, 4558, 2334, 1666, 1610]}, "random_specified": {"generated": "2011-03-31 05:50 UTC", "data": [1671, 2019, 2961, 4060, 2970, 3372, 4487, 2330, 1711, 1517]}}, "select": {"random_not_specified": {"generated": "2011-03-31 05:50 UTC", "data": [1428, 1932, 2821, 3206, 2570, 4194, 5032, 2792, 1669, 1581]}, "random_specified": {"generated": "2011-03-31 05:50 UTC", "data": [1505, 1851, 2753, 3149, 2411, 4038, 4874, 2872, 1724, 1531]}}, "slider": {"random_not_specified": {"generated": "2011-03-31 05:50 UTC", "data": [2226, 1532, 2858, 4173, 2984, 3434, 4199, 2175, 1365, 1380]}, "random_specified": {"generated": "2011-03-31 05:50 UTC", "data": [2392, 1543, 2749, 4123, 2788, 3473, 4420, 2347, 1302, 1339]}}}, "overtime": [[[1301242316.0, 88], [1301245916.0, 119], [1301249516.0, 637], [1301253116.0, 1585], [1301256716.0, 1124], [1301260316.0, 1133], [1301263916.0, 1218], [1301267516.0, 947], [1301271116.0, 788], [1301274716.0, 691], [1301278316.0, 732], [1301281916.0, 586], [1301285516.0, 448], [1301289116.0, 304], [1301292716.0, 343], [1301296316.0, 225], [1301299916.0, 207], [1301303516.0, 183], [1301307116.0, 162], [1301310716.0, 217], [1301314316.0, 233], [1301317916.0, 279], [1301321516.0, 189], [1301325116.0, 162], [1301328716.0, 171], [1301332316.0, 242], [1301335916.0, 73], [1301339516.0, 46], [1301343116.0, 43], [1301346716.0, 39], [1301350316.0, 39], [1301353916.0, 46], [1301357516.0, 30], [1301361116.0, 37], [1301364716.0, 43], [1301368316.0, 33], [1301371916.0, 40], [1301375516.0, 33], [1301379116.0, 19], [1301382716.0, 6], [1301386316.0, 12], [1301389916.0, 14], [1301393516.0, 16], [1301397116.0, 11], [1301400716.0, 19], [1301404316.0, 13], [1301407916.0, 10], [1301411516.0, 15], [1301415116.0, 28], [1301418716.0, 17], [1301422316.0, 17], [1301425916.0, 19], [1301429516.0, 17], [1301433116.0, 17], [1301436716.0, 16], [1301440316.0, 16], [1301443916.0, 22], [1301447516.0, 12], [1301451116.0, 14], [1301454716.0, 18], [1301458316.0, 18], [1301461916.0, 9], [1301465516.0, 6]], [[1301242316.0, 61], [1301245916.0, 125], [1301249516.0, 787], [1301253116.0, 2156], [1301256716.0, 1619], [1301260316.0, 1612], [1301263916.0, 1247], [1301267516.0, 1049], [1301271116.0, 700], [1301274716.0, 641], [1301278316.0, 684], [1301281916.0, 484], [1301285516.0, 425], [1301289116.0, 312], [1301292716.0, 344], [1301296316.0, 223], [1301299916.0, 189], [1301303516.0, 179], [1301307116.0, 119], [1301310716.0, 158], [1301314316.0, 207], [1301317916.0, 218], [1301321516.0, 175], [1301325116.0, 126], [1301328716.0, 227], [1301332316.0, 124], [1301335916.0, 68], [1301339516.0, 54], [1301343116.0, 48], [1301346716.0, 40], [1301350316.0, 36], [1301353916.0, 42], [1301357516.0, 43], [1301361116.0, 42], [1301364716.0, 21], [1301368316.0, 34], [1301371916.0, 42], [1301375516.0, 23], [1301379116.0, 20], [1301382716.0, 11], [1301386316.0, 11], [1301389916.0, 8], [1301393516.0, 8], [1301397116.0, 14], [1301400716.0, 7], [1301404316.0, 11], [1301407916.0, 16], [1301411516.0, 15], [1301415116.0, 14], [1301418716.0, 15], [1301422316.0, 14], [1301425916.0, 18], [1301429516.0, 16], [1301433116.0, 23], [1301436716.0, 17], [1301440316.0, 15], [1301443916.0, 17], [1301447516.0, 24], [1301451116.0, 13], [1301454716.0, 24], [1301458316.0, 17], [1301461916.0, 7], [1301465516.0, 9]], [[1301242316.0, 86], [1301245916.0, 192], [1301249516.0, 1150], [1301253116.0, 3120], [1301256716.0, 2314], [1301260316.0, 2280], [1301263916.0, 1892], [1301267516.0, 1560], [1301271116.0, 1157], [1301274716.0, 979], [1301278316.0, 1060], [1301281916.0, 886], [1301285516.0, 636], [1301289116.0, 504], [1301292716.0, 441], [1301296316.0, 313], [1301299916.0, 268], [1301303516.0, 209], [1301307116.0, 195], [1301310716.0, 262], [1301314316.0, 308], [1301317916.0, 383], [1301321516.0, 296], [1301325116.0, 145], [1301328716.0, 280], [1301332316.0, 176], [1301335916.0, 92], [1301339516.0, 100], [1301343116.0, 72], [1301346716.0, 71], [1301350316.0, 50], [1301353916.0, 57], [1301357516.0, 71], [1301361116.0, 50], [1301364716.0, 57], [1301368316.0, 49], [1301371916.0, 76], [1301375516.0, 35], [1301379116.0, 24], [1301382716.0, 22], [1301386316.0, 12], [1301389916.0, 12], [1301393516.0, 16], [1301397116.0, 29], [1301400716.0, 20], [1301404316.0, 18], [1301407916.0, 18], [1301411516.0, 17], [1301415116.0, 16], [1301418716.0, 20], [1301422316.0, 26], [1301425916.0, 32], [1301429516.0, 35], [1301433116.0, 42], [1301436716.0, 38], [1301440316.0, 36], [1301443916.0, 35], [1301447516.0, 32], [1301451116.0, 37], [1301454716.0, 48], [1301458316.0, 17], [1301461916.0, 18], [1301465516.0, 13]], [[1301242316.0, 94], [1301245916.0, 234], [1301249516.0, 1466], [1301253116.0, 4066], [1301256716.0, 2963], [1301260316.0, 2780], [1301263916.0, 2527], [1301267516.0, 2004], [1301271116.0, 1396], [1301274716.0, 1270], [1301278316.0, 1238], [1301281916.0, 1001], [1301285516.0, 788], [1301289116.0, 635], [1301292716.0, 564], [1301296316.0, 391], [1301299916.0, 333], [1301303516.0, 274], [1301307116.0, 236], [1301310716.0, 319], [1301314316.0, 421], [1301317916.0, 435], [1301321516.0, 335], [1301325116.0, 226], [1301328716.0, 309], [1301332316.0, 256], [1301335916.0, 114], [1301339516.0, 104], [1301343116.0, 64], [1301346716.0, 77], [1301350316.0, 89], [1301353916.0, 89], [1301357516.0, 96], [1301361116.0, 72], [1301364716.0, 92], [1301368316.0, 66], [1301371916.0, 97], [1301375516.0, 66], [1301379116.0, 55], [1301382716.0, 26], [1301386316.0, 20], [1301389916.0, 17], [1301393516.0, 12], [1301397116.0, 20], [1301400716.0, 24], [1301404316.0, 13], [1301407916.0, 36], [1301411516.0, 21], [1301415116.0, 26], [1301418716.0, 27], [1301422316.0, 30], [1301425916.0, 35], [1301429516.0, 61], [1301433116.0, 51], [1301436716.0, 43], [1301440316.0, 39], [1301443916.0, 35], [1301447516.0, 76], [1301451116.0, 61], [1301454716.0, 47], [1301458316.0, 25], [1301461916.0, 35], [1301465516.0, 16]], [[1301242316.0, 67], [1301245916.0, 212], [1301249516.0, 1140], [1301253116.0, 3147], [1301256716.0, 2151], [1301260316.0, 2153], [1301263916.0, 1852], [1301267516.0, 1528], [1301271116.0, 1048], [1301274716.0, 5403], [1301278316.0, 923], [1301281916.0, 760], [1301285516.0, 610], [1301289116.0, 467], [1301292716.0, 475], [1301296316.0, 326], [1301299916.0, 304], [1301303516.0, 226], [1301307116.0, 215], [1301310716.0, 229], [1301314316.0, 340], [1301317916.0, 373], [1301321516.0, 252], [1301325116.0, 188], [1301328716.0, 284], [1301332316.0, 159], [1301335916.0, 101], [1301339516.0, 102], [1301343116.0, 69], [1301346716.0, 91], [1301350316.0, 72], [1301353916.0, 81], [1301357516.0, 69], [1301361116.0, 60], [1301364716.0, 71], [1301368316.0, 70], [1301371916.0, 79], [1301375516.0, 65], [1301379116.0, 41], [1301382716.0, 19], [1301386316.0, 15], [1301389916.0, 24], [1301393516.0, 19], [1301397116.0, 26], [1301400716.0, 18], [1301404316.0, 19], [1301407916.0, 24], [1301411516.0, 18], [1301415116.0, 27], [1301418716.0, 27], [1301422316.0, 35], [1301425916.0, 47], [1301429516.0, 38], [1301433116.0, 50], [1301436716.0, 33], [1301440316.0, 30], [1301443916.0, 38], [1301447516.0, 42], [1301451116.0, 47], [1301454716.0, 49], [1301458316.0, 28], [1301461916.0, 20], [1301465516.0, 13]], [[1301242316.0, 85], [1301245916.0, 203], [1301249516.0, 1306], [1301253116.0, 3742], [1301256716.0, 2699], [1301260316.0, 2623], [1301263916.0, 2314], [1301267516.0, 1924], [1301271116.0, 1379], [1301274716.0, 1239], [1301278316.0, 1245], [1301281916.0, 944], [1301285516.0, 712], [1301289116.0, 519], [1301292716.0, 480], [1301296316.0, 379], [1301299916.0, 308], [1301303516.0, 274], [1301307116.0, 259], [1301310716.0, 340], [1301314316.0, 389], [1301317916.0, 461], [1301321516.0, 329], [1301325116.0, 215], [1301328716.0, 314], [1301332316.0, 215], [1301335916.0, 139], [1301339516.0, 89], [1301343116.0, 100], [1301346716.0, 100], [1301350316.0, 68], [1301353916.0, 72], [1301357516.0, 69], [1301361116.0, 60], [1301364716.0, 80], [1301368316.0, 77], [1301371916.0, 73], [1301375516.0, 60], [1301379116.0, 42], [1301382716.0, 24], [1301386316.0, 20], [1301389916.0, 25], [1301393516.0, 16], [1301397116.0, 24], [1301400716.0, 27], [1301404316.0, 27], [1301407916.0, 25], [1301411516.0, 32], [1301415116.0, 33], [1301418716.0, 31], [1301422316.0, 28], [1301425916.0, 60], [1301429516.0, 61], [1301433116.0, 55], [1301436716.0, 85], [1301440316.0, 51], [1301443916.0, 47], [1301447516.0, 57], [1301451116.0, 52], [1301454716.0, 42], [1301458316.0, 25], [1301461916.0, 39], [1301465516.0, 18]], [[1301242316.0, 130], [1301245916.0, 257], [1301249516.0, 1701], [1301253116.0, 5047], [1301256716.0, 3556], [1301260316.0, 3532], [1301263916.0, 3173], [1301267516.0, 2562], [1301271116.0, 1774], [1301274716.0, 1569], [1301278316.0, 1566], [1301281916.0, 1359], [1301285516.0, 975], [1301289116.0, 769], [1301292716.0, 771], [1301296316.0, 502], [1301299916.0, 385], [1301303516.0, 356], [1301307116.0, 348], [1301310716.0, 373], [1301314316.0, 483], [1301317916.0, 644], [1301321516.0, 450], [1301325116.0, 307], [1301328716.0, 440], [1301332316.0, 279], [1301335916.0, 153], [1301339516.0, 136], [1301343116.0, 120], [1301346716.0, 108], [1301350316.0, 92], [1301353916.0, 95], [1301357516.0, 101], [1301361116.0, 117], [1301364716.0, 102], [1301368316.0, 95], [1301371916.0, 101], [1301375516.0, 88], [1301379116.0, 53], [1301382716.0, 35], [1301386316.0, 29], [1301389916.0, 19], [1301393516.0, 16], [1301397116.0, 42], [1301400716.0, 37], [1301404316.0, 29], [1301407916.0, 50], [1301411516.0, 40], [1301415116.0, 54], [1301418716.0, 42], [1301422316.0, 50], [1301425916.0, 69], [1301429516.0, 48], [1301433116.0, 66], [1301436716.0, 57], [1301440316.0, 45], [1301443916.0, 71], [1301447516.0, 71], [1301451116.0, 71], [1301454716.0, 56], [1301458316.0, 26], [1301461916.0, 32], [1301465516.0, 22]], [[1301242316.0, 87], [1301245916.0, 172], [1301249516.0, 964], [1301253116.0, 2803], [1301256716.0, 2075], [1301260316.0, 1999], [1301263916.0, 1763], [1301267516.0, 1454], [1301271116.0, 1031], [1301274716.0, 909], [1301278316.0, 884], [1301281916.0, 769], [1301285516.0, 544], [1301289116.0, 423], [1301292716.0, 364], [1301296316.0, 286], [1301299916.0, 221], [1301303516.0, 194], [1301307116.0, 189], [1301310716.0, 212], [1301314316.0, 285], [1301317916.0, 365], [1301321516.0, 262], [1301325116.0, 154], [1301328716.0, 235], [1301332316.0, 152], [1301335916.0, 107], [1301339516.0, 68], [1301343116.0, 58], [1301346716.0, 68], [1301350316.0, 58], [1301353916.0, 64], [1301357516.0, 66], [1301361116.0, 51], [1301364716.0, 67], [1301368316.0, 63], [1301371916.0, 50], [1301375516.0, 36], [1301379116.0, 18], [1301382716.0, 17], [1301386316.0, 10], [1301389916.0, 14], [1301393516.0, 12], [1301397116.0, 22], [1301400716.0, 21], [1301404316.0, 17], [1301407916.0, 35], [1301411516.0, 24], [1301415116.0, 25], [1301418716.0, 20], [1301422316.0, 22], [1301425916.0, 17], [1301429516.0, 25], [1301433116.0, 29], [1301436716.0, 27], [1301440316.0, 28], [1301443916.0, 25], [1301447516.0, 36], [1301451116.0, 28], [1301454716.0, 29], [1301458316.0, 22], [1301461916.0, 19], [1301465516.0, 7]], [[1301242316.0, 65], [1301245916.0, 106], [1301249516.0, 656], [1301253116.0, 1797], [1301256716.0, 1357], [1301260316.0, 1362], [1301263916.0, 1113], [1301267516.0, 969], [1301271116.0, 606], [1301274716.0, 562], [1301278316.0, 526], [1301281916.0, 510], [1301285516.0, 339], [1301289116.0, 256], [1301292716.0, 261], [1301296316.0, 175], [1301299916.0, 168], [1301303516.0, 153], [1301307116.0, 139], [1301310716.0, 133], [1301314316.0, 206], [1301317916.0, 265], [1301321516.0, 136], [1301325116.0, 107], [1301328716.0, 165], [1301332316.0, 106], [1301335916.0, 59], [1301339516.0, 43], [1301343116.0, 37], [1301346716.0, 40], [1301350316.0, 33], [1301353916.0, 32], [1301357516.0, 25], [1301361116.0, 22], [1301364716.0, 26], [1301368316.0, 25], [1301371916.0, 30], [1301375516.0, 28], [1301379116.0, 14], [1301382716.0, 22], [1301386316.0, 7], [1301389916.0, 11], [1301393516.0, 5], [1301397116.0, 12], [1301400716.0, 12], [1301404316.0, 6], [1301407916.0, 10], [1301411516.0, 19], [1301415116.0, 6], [1301418716.0, 11], [1301422316.0, 14], [1301425916.0, 21], [1301429516.0, 23], [1301433116.0, 20], [1301436716.0, 14], [1301440316.0, 14], [1301443916.0, 9], [1301447516.0, 15], [1301451116.0, 8], [1301454716.0, 19], [1301458316.0, 4], [1301461916.0, 13], [1301465516.0, 5]], [[1301242316.0, 59], [1301245916.0, 120], [1301249516.0, 636], [1301253116.0, 1602], [1301256716.0, 1148], [1301260316.0, 1297], [1301263916.0, 834], [1301267516.0, 674], [1301271116.0, 538], [1301274716.0, 441], [1301278316.0, 446], [1301281916.0, 363], [1301285516.0, 257], [1301289116.0, 234], [1301292716.0, 233], [1301296316.0, 190], [1301299916.0, 152], [1301303516.0, 126], [1301307116.0, 104], [1301310716.0, 154], [1301314316.0, 175], [1301317916.0, 197], [1301321516.0, 123], [1301325116.0, 93], [1301328716.0, 156], [1301332316.0, 104], [1301335916.0, 41], [1301339516.0, 46], [1301343116.0, 36], [1301346716.0, 31], [1301350316.0, 25], [1301353916.0, 23], [1301357516.0, 16], [1301361116.0, 20], [1301364716.0, 21], [1301368316.0, 15], [1301371916.0, 19], [1301375516.0, 23], [1301379116.0, 7], [1301382716.0, 11], [1301386316.0, 9], [1301389916.0, 8], [1301393516.0, 5], [1301397116.0, 2], [1301400716.0, 14], [1301404316.0, 11], [1301407916.0, 9], [1301411516.0, 6], [1301415116.0, 14], [1301418716.0, 5], [1301422316.0, 11], [1301425916.0, 12], [1301429516.0, 4], [1301433116.0, 11], [1301436716.0, 14], [1301440316.0, 11], [1301443916.0, 12], [1301447516.0, 10], [1301451116.0, 6], [1301454716.0, 10], [1301458316.0, 5], [1301461916.0, 6], [1301465516.0, 4]]]}
data_url = "/data/"
data = {}

country_data={US:{data:{"1":8782,"2":9891,"3":15130,"4":19064,"5":14047,"6":17968,"7":24062,"8":13477,"9":8442,"10":6827},total:137690},CA:{data:{"1":1370,"2":1373,"3":2178,"4":2697,"5":2195,"6":2564,"7":3234,"8":1952,"9":1274,"10":1105},total:19942},GB:{data:{"1":884,"2":978,"3":1305,"4":1875,"5":1375,"6":1707,"7":2006,"8":1088,"9":758,"10":724},total:12700},AU:{data:{"1":418,"2":437,"3":588,"4":732,"5":521,"6":635,"7":929,"8":451,"9":349,"10":327},total:5387},DE:{data:{"1":238,"2":234,"3":317,"4":382,"5":403,"6":378,"7":598,"8":330,"9":203,"10":214},total:3297}}


overall_data = ([i,0] for i in [1..10])

generated = null

getData = ->
    $.getJSON data_url, {}, (response) ->
         data = response
         drawGraphs()
     # drawGraphs()


drawGraphs = ->
    main_data = data.breakdown
    time_data = data.overtime

    $("#spinner").hide()
    $("#graphs").show()
    graph_boxes =
        overall: $("#overview-graph")
        input: $("#input-graph")
        radio: $("#radio-graph")
        select: $("#select-graph")
        slider: $("#slider-graph")
        overtime: $("#overtime-graph")
        country: $("#country-graph")

    generated = main_data.input.random_not_specified.generated

    sum = 0
    for method, results of main_data
        graph_opts = []
        for random_specified in ["random_specified", "random_not_specified"]
            res = results[random_specified]
            label = random_specified.replace(/_/g," ")

            for i in [1..10]
                overall_data[i-1][1] += res.data[i-1]
                sum += res.data[i-1]

            graph_data = ([i,res.data[i-1]] for i in [1..10])
    
            graph_opts.push
                label: label
                bars:
                    show: true
                    align: "center"
                    barwidth : 0.1
                data: graph_data

        $.plot(graph_boxes[method], graph_opts)

    overall_opts =
        bars:
            show: true
            align: "center"
        data: overall_data
    $.plot(graph_boxes.overall, [overall_opts])
    
    # graph_data = ([i,res.data[i-1]] for i in [1..10])
    time_opts = []

    ticks = []

    t_start = 0
    t_end = 0
    for num, datas of time_data
        # console.log datas[0]
        t_start = datas[0][0]
        t_end = datas[datas.length-1][0]
        
        time_opts.push
            label: (parseInt(num) + 1).toString()
            lines:
                show: true
            data: datas

    t_diff = (t_end - t_start) / 4
    ticks = [t_start]
    for i in [1..4]
        new_t = t_start + (t_diff * i)
        ticks.push(new_t)
    
    for i in [0...ticks.length]
        d = new Date(ticks[i] * 1000)
        ticks[i] = [ticks[i],"#{d.getFullYear()}-#{d.getMonth()+1}-#{d.getDate()} #{d.getHours()}:#{d.getMinutes()}"]

    time_settings =
        xaxis:
            ticks: ticks

    $.plot(graph_boxes.overtime, time_opts, time_settings)
    
    
    # {US:{data:{"1":8782,"2":9891,"3":15130,"4":19064,"5":14047,"6":17968,"7":24062,"8":13477,"9":8442,"10":6827},total:137690},
    
    
    country_graph_data = []
    for country, cdata of country_data
        d = []
        for k, v of cdata.data
            d.push([parseInt(k),v/cdata.total])
        country_graph_data.push
            label: country
            lines:
                show: true
            data: d
    
    country_graph_settings =
        xaxis:
            ticks: ([i,i] for i in [1..10])

    $.plot(graph_boxes.country, country_graph_data, country_graph_settings)
    
    $("#as-of").html("Here's a breakdown as of <strong>#{generated}</strong><br>Total votes: <strong>#{sum}</strong>")

init = ->
    getData()

$(document).ready(init)
